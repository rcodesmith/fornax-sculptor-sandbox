<workflow abstract="true">

	<bean class="org.eclipse.emf.mwe.utils.StandaloneSetup">
		<platformUri value=".."/> 	
		<!-- Register Sculptor dsl meta model -->
    	<registerGeneratedEPackage value="org.fornax.cartridges.sculptor.dsl.sculptordsl.SculptordslPackage"/>    	
		<!-- Register Sculptor meta model -->
		<registerGeneratedEPackage value="sculptormetamodel.SculptormetamodelPackage"/>    	
	</bean>	
	
	<!-- Load/reload generator properties -->
	<bean id="initProperties" class="org.fornax.cartridges.sculptor.generator.util.GeneratorProperties" />
	
	<component class="org.eclipse.emf.mwe.utils.DirectoryCleaner" directory="src-gen"/>	
	
	<component class="org.eclipse.xtext.MweReader" uri="${modelFile}">
		<!-- this class will be generated by the xtext generator -->
		<register class="org.fornax.cartridges.sculptor.dsl.SculptordslStandaloneSetup"/>		
	</component>			
   	
   	<!-- Validate the DSL model -->
    <component class="org.eclipse.xtend.check.CheckComponent">
		<metaModel id="metamodel" class="org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel"
        	useSingleGlobalResourceSet="true"/>
		<checkFile value="org/fornax/cartridges/sculptor/dsl/validation/SculptordslChecks"/>
		<emfAllChildrenSlot value="model"/>
	</component>
		
	<!-- Model transformation from DSL meta model to meta model -->
    <component class="org.eclipse.xtend.XtendComponent">    	   
    	<metaModel id="metamodel" class="org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel"
        	useSingleGlobalResourceSet="true"/> 	 
 	    <invoke value="transformation::DslTransformation::transform(model)"/>     
 	    <outputSlot value="transformedModel"/> 
	</component>
	
	<!-- Model validation before transformation -->
    <component class="org.eclipse.xtend.check.CheckComponent">
		<metaModel id="metamodel" class="org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel"
        	useSingleGlobalResourceSet="true"/>
		<checkFile value="constraints/constraints"/>
		<emfAllChildrenSlot value="model"/>
	</component>
    
    <!-- Model transformation -->
    <component id="modelTransformation" class="org.eclipse.xtend.XtendComponent">
		<metaModel id="metamodel" class="org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel"
        	useSingleGlobalResourceSet="true"/>
 	    <invoke value="transformation::Transformation::modify(transformedModel)"/>
 	    <outputSlot value="transformedModel"/>
	</component>

    <!-- Model validation after transformation -->
    <component class="org.eclipse.xtend.check.CheckComponent">
		<metaModel id="metamodel" class="org.eclipse.xtend.typesystem.emf.EmfRegistryMetaModel"
        	useSingleGlobalResourceSet="true"/>
		<checkFile value="constraints/constraints"/>
		<emfAllChildrenSlot value="transformedModel"/>
	</component>
</workflow>
